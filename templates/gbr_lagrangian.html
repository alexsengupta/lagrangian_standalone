<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>GBR Lagrangian Visualization</title>
  <link href="https://unpkg.com/mapbox-gl@3.0.1/dist/mapbox-gl.css" rel="stylesheet"/>
  <style>
    body { font-family: system-ui; margin: 20px; }
    #controls { margin-bottom: 10px; }
    #controls button, #controls label { margin-right: 8px; }
    /* Highlight active button */
    #controls button.active { background-color: #007bff; color: #fff; }
    #map { width: 90vw; height: 80vh; }
    #info-popup-box { display: none; }
  </style>
</head>
<body>
  <h2>Great Barrier Reef Lagrangian Simulation</h2>
  <div id="controls">
    <button id="btn-manual">Manual</button>
    <button id="btn-traj">Trajectories</button>
    <button id="btn-anim">Animation</button>
    <label id="manual-controls" style="display:none;">
      Time:
      <input type="range" id="aus-manual-slider" min="0" max="0" step="1" value="0">
      <span id="aus-time-label">0</span>
    </label>
    <label id="anim-speed-controls" style="display:none;">
      Speed:
      <input type="range" id="aus-speed-slider" min="50" max="1000" step="50" value="200">
      <span id="aus-speed-label">200 ms</span>
    </label>
    <button id="aus-anim-btn" style="display:none;">Start Animation</button>
    <button id="aus-reset-btn" style="display:none;">Reset</button>
    <span id="aus-anim-status"></span>
    <button id="aus-save-btn">Save Data</button>
  </div>
  <div id="map"></div>
  <div id="info-popup-box"></div>

  <script src="https://unpkg.com/mapbox-gl@3.0.1/dist/mapbox-gl.js"></script>
  <!-- Load viz_gbr.js from Flask static endpoint -->
  <script src="/lagrangian_6Aug/static/viz_gbr.js"></script>
  <script>
    const simData = {{ sim_data|tojson }};
    vizMap(simData);
  </script>
</body>
</html>